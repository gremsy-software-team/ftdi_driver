cmake_minimum_required(VERSION 3.5)

project(ftdi_module C)

include (ExternalProject)

ExternalProject_Add(${PROJECT_NAME}
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}"
	DOWNLOAD_COMMAND cp -dpRf ${CMAKE_CURRENT_SOURCE_DIR} ${CMAKE_CURRENT_BINARY_DIR}/
	BUILD_COMMAND $(MAKE) -C ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME} CROSS_COMPILE=${TOOLCHAIN_NAME}- ARCH=${KERNEL_ARCH} KERNEL_HEADERS_DIR=${KERNELHEADERS_DIR}
	INSTALL_COMMAND cp -dpRf ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}/${PROJECT_NAME}.ko ${FAKEROOT_DIR}/lib/modules/${KERNEL_VERSION}/extra/
)